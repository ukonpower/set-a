import * as GLP from 'glpower';
import { canvas, gl, globalUniforms } from '~/ts/Globals';

import titleVert from './shaders/mainTitle.vs';
import titleFrag from './shaders/mainTitle.fs';
import { hotGet, hotUpdate } from '~/ts/libs/glpower_local/Framework/Utils/Hot';

export class MainTitle extends GLP.Entity {

	constructor( ) {

		super();

		const enElm = `
		<svg width="865" height="273" viewBox="0 0 865 273" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M713.149 267.095L760.393 5.34822C760.647 4.33222 761.282 3.82422 762.298 3.82422H817.543C818.559 3.82422 819.194 4.33222 819.448 5.34822L864.787 267.095C865.041 268.365 864.533 269 863.263 269H820.972C819.956 269 819.321 268.365 819.067 267.095L814.876 239.282H763.06L758.869 267.095C758.615 268.365 757.98 269 756.964 269H714.673C713.657 269 713.149 268.365 713.149 267.095ZM770.68 198.515H807.256L791.635 91.4542L789.349 77.3572L787.825 91.4542L770.68 198.515Z" fill="white"/>
		<path d="M548.325 158.891C547.055 158.891 546.42 158.383 546.42 157.367V115.838C546.42 114.822 547.055 114.314 548.325 114.314H621.858C623.128 114.314 623.763 114.822 623.763 115.838V157.367C623.763 158.383 623.128 158.891 621.858 158.891H548.325Z" fill="white"/>
		<path d="M374.273 269C373.257 269 372.749 268.365 372.749 267.095V49.9252H323.219C321.949 49.9252 321.314 49.2902 321.314 48.0202L321.695 5.34822C321.695 4.33222 322.203 3.82422 323.219 3.82422H467.999C469.269 3.82422 469.904 4.33222 469.904 5.34822V48.0202C469.904 49.2902 469.396 49.9252 468.38 49.9252H418.469L418.85 267.095C418.85 268.365 418.342 269 417.326 269H374.273Z" fill="white"/>
		<path d="M177.708 269C176.692 269 176.184 268.365 176.184 267.095L176.565 5.34822C176.565 4.33222 177.073 3.82422 178.089 3.82422H300.39C301.406 3.82422 301.914 4.45922 301.914 5.72922V48.4012C301.914 49.4172 301.406 49.9252 300.39 49.9252H222.285V109.361H300.39C301.406 109.361 301.914 109.869 301.914 110.885L302.295 153.938C302.295 154.954 301.787 155.462 300.771 155.462H222.285V222.137H300.771C301.787 222.137 302.295 222.772 302.295 224.042V267.476C302.295 268.492 301.787 269 300.771 269H177.708Z" fill="white"/>
		<path d="M75.01 272.81C61.294 272.81 48.721 269.381 37.291 262.523C26.115 255.411 17.098 246.14 10.24 234.71C3.63598 223.026 0.333984 210.199 0.333984 196.229V178.703C0.333984 177.433 0.968984 176.798 2.23898 176.798H44.911C45.927 176.798 46.435 177.433 46.435 178.703V196.229C46.435 204.611 49.229 211.85 54.817 217.946C60.405 223.788 67.136 226.709 75.01 226.709C82.884 226.709 89.615 223.661 95.203 217.565C100.791 211.469 103.585 204.357 103.585 196.229C103.585 186.831 97.489 178.703 85.297 171.845C81.233 169.559 74.883 166.003 66.247 161.177C57.611 156.351 49.483 151.779 41.863 147.461C27.893 139.333 17.479 129.173 10.621 116.981C4.01698 104.535 0.714984 90.5652 0.714984 75.0712C0.714984 60.8472 4.14398 48.1472 11.002 36.9712C17.86 25.5412 26.877 16.5242 38.053 9.92017C49.483 3.31616 61.802 0.0141602 75.01 0.0141602C88.472 0.0141602 100.791 3.44316 111.967 10.3012C123.397 16.9052 132.414 25.9222 139.018 37.3522C145.876 48.5282 149.305 61.1012 149.305 75.0712V106.313C149.305 107.329 148.797 107.837 147.781 107.837H105.109C104.093 107.837 103.585 107.329 103.585 106.313L103.204 75.0712C103.204 66.1812 100.41 58.9422 94.822 53.3542C89.234 47.7662 82.63 44.9722 75.01 44.9722C67.136 44.9722 60.405 48.0202 54.817 54.1162C49.229 59.9582 46.435 66.9432 46.435 75.0712C46.435 83.4532 48.213 90.4382 51.769 96.0262C55.325 101.614 61.802 106.948 71.2 112.028C72.47 112.79 74.883 114.187 78.439 116.219C82.249 117.997 86.313 120.156 90.631 122.696C94.949 124.982 98.759 127.014 102.061 128.792C105.617 130.57 107.776 131.713 108.538 132.221C121.238 139.333 131.271 148.096 138.637 158.51C146.003 168.67 149.686 181.243 149.686 196.229C149.686 210.707 146.257 223.788 139.399 235.472C132.795 246.902 123.778 256.046 112.348 262.904C101.172 269.508 88.726 272.81 75.01 272.81Z" fill="white"/>
		</svg>
		`;

		const textureEn = new GLP.GLPowerTexture( gl );

		const enImg = document.createElement( "img" );
		enImg.src = "data:image/svg+xml," + encodeURIComponent( enElm );

		enImg.onload = () => {

			const canvas = document.createElement( "canvas" );
			canvas.width = 1024;
			canvas.height = 512;

			const ctx = canvas.getContext( "2d" )!;

			ctx.fillStyle = "#fff3";
			ctx.fillRect( 0, 0, canvas.width, canvas.height );

			ctx.drawImage( enImg, 0, 50 );

			ctx.fillStyle = "#FFF";
			ctx.font = `bold ${50}px 'Yu Gothic'`;
			ctx.fillText( "CODE / GRAPHICS / MUSIC: UKONPOWER", 0, 400, 600 );

			textureEn.attach( canvas );

		};


		const jaElm = `
		<svg width="747" height="221" viewBox="0 0 747 221" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M202.128 203.664C203.184 203.664 203.712 204.72 203.712 206.832C203.712 208.944 203.184 210 202.128 210H115.272C114.568 210 114.04 209.736 113.688 209.208C113.512 208.68 113.424 207.888 113.424 206.832C113.424 204.72 114.04 203.664 115.272 203.664C123.016 203.312 128.824 202.344 132.696 200.76C136.568 199 138.504 196.096 138.504 192.048C138.504 189.584 137.624 185.888 135.864 180.96C135.864 181.136 133.312 173.832 128.208 159.048C126.976 155.88 125.128 150.6 122.664 143.208H56.928C52.176 156.232 47.952 168.288 44.256 179.376C43.2 181.84 42.672 184.744 42.672 188.088C42.672 198.472 51.384 203.664 68.808 203.664C69.864 203.664 70.392 204.72 70.392 206.832C70.392 208.944 69.864 210 68.808 210H2.016C1.312 210 0.784 209.736 0.432 209.208C0.256 208.68 0.168 207.888 0.168 206.832C0.168 204.72 0.784 203.664 2.016 203.664C7.824 203.664 13.28 201.904 18.384 198.384C23.664 194.688 27.976 188.792 31.32 180.696L45.048 144.264C52.968 123.672 61.504 101.056 70.656 76.416C79.984 51.776 87.552 31.888 93.36 16.752L110.784 11.736C112.544 11.736 113.688 12.704 114.216 14.64C119.672 30.656 129.792 60.136 144.576 103.08C159.536 145.848 168.6 171.368 171.768 179.64C174.408 186.856 176.96 192.136 179.424 195.48C182.064 198.824 184.968 201.024 188.136 202.08C191.48 203.136 196.144 203.664 202.128 203.664ZM119.496 133.44L90.72 50.544L60.36 133.44H119.496ZM354.159 123.408C354.159 123.056 354.863 122.088 356.271 120.504C361.551 114.872 366.391 108.184 370.791 100.44C375.367 92.52 377.743 86.624 377.919 82.752C377.919 81.168 376.863 80.376 374.751 80.376C372.991 80.376 366.831 81.784 356.271 84.6C345.887 87.416 335.503 90.672 325.119 94.368C324.063 106.16 323.535 117.336 323.535 127.896C323.535 138.104 323.975 146.112 324.855 151.92C325.735 157.728 328.023 162.48 331.719 166.176C335.415 169.872 341.223 171.72 349.143 171.72C353.543 171.72 357.855 171.28 362.079 170.4C366.303 169.52 371.407 168.288 377.391 166.704C378.271 166.528 380.559 166 384.255 165.12C387.951 164.064 391.031 163.536 393.495 163.536C399.655 163.536 405.463 164.856 410.919 167.496C416.375 170.136 419.103 173.656 419.103 178.056C419.103 184.568 413.207 189.32 401.415 192.312C395.959 193.72 389.183 194.776 381.087 195.48C372.991 196.184 364.807 196.536 356.535 196.536C342.103 196.536 330.927 194.864 323.007 191.52C315.087 188.176 309.455 182.72 306.111 175.152C302.767 167.408 301.095 156.672 301.095 142.944C301.095 135.552 301.447 122.352 302.151 103.344C301.975 103.344 301.535 103.52 300.831 103.872C296.079 106.16 289.743 109.416 281.823 113.64C276.367 116.632 272.055 118.832 268.887 120.24C265.895 121.648 263.431 122.352 261.495 122.352C256.743 122.352 251.463 120.68 245.655 117.336C239.847 113.816 234.831 109.768 230.607 105.192C226.559 100.44 224.535 96.568 224.535 93.576C224.535 92.344 225.151 91.728 226.383 91.728C227.439 91.728 229.375 92.52 232.191 94.104C237.119 96.392 242.575 97.536 248.559 97.536C251.727 97.536 258.943 96.304 270.207 93.84C281.647 91.2 292.559 88.472 302.943 85.656C303.295 71.224 303.471 61.104 303.471 55.296C303.471 50.72 302.855 47.024 301.623 44.208C300.567 41.216 298.103 38.576 294.231 36.288C292.647 35.232 290.975 34.44 289.215 33.912C287.631 33.208 286.487 32.592 285.783 32.064C285.079 31.536 284.727 30.92 284.727 30.216C284.727 29.16 285.871 27.752 288.159 25.992C290.623 24.232 293.527 22.648 296.871 21.24C300.391 19.832 303.735 19.128 306.903 19.128C310.071 19.128 314.119 20.184 319.047 22.296C323.975 24.408 328.287 27.136 331.983 30.48C335.679 33.648 337.527 36.992 337.527 40.512C337.527 42.976 336.471 46.144 334.359 50.016C333.303 52.304 332.247 54.856 331.191 57.672C330.135 60.488 329.343 63.48 328.815 66.648C328.111 69.64 327.495 73.512 326.967 78.264L341.751 73.512C357.239 68.76 366.127 65.856 368.415 64.8C371.055 63.744 374.135 61.984 377.655 59.52C378.887 58.64 380.031 57.936 381.087 57.408C382.319 56.704 383.375 56.352 384.255 56.352C385.663 56.352 389.711 57.936 396.399 61.104C403.087 64.096 409.159 67.704 414.615 71.928C420.071 75.976 422.799 79.936 422.799 83.808C422.799 85.568 421.919 86.976 420.159 88.032C418.399 89.088 415.055 90.584 410.127 92.52C407.839 93.4 405.463 94.544 402.999 95.952C400.711 97.36 398.335 98.944 395.871 100.704C392.527 103.344 389.271 105.632 386.103 107.568C374.663 114.432 365.423 119.448 358.383 122.616L354.687 123.936C354.335 123.936 354.159 123.76 354.159 123.408ZM523.476 134.007C520.848 134.007 518.658 132.912 516.906 130.722C515.154 128.532 514.059 125.904 513.621 122.838C512.599 116.852 510.774 111.523 508.146 106.851C505.664 102.033 502.671 98.31 499.167 95.682C498.875 95.39 498.437 95.025 497.853 94.587C497.269 94.003 496.977 93.492 496.977 93.054C496.977 92.178 497.707 91.74 499.167 91.74C502.379 91.74 506.832 93.054 512.526 95.682C518.22 98.31 523.257 101.887 527.637 106.413C532.017 110.793 534.207 115.611 534.207 120.867C534.207 124.809 533.185 128.021 531.141 130.503C529.243 132.839 526.688 134.007 523.476 134.007ZM471.135 217.665C469.821 217.665 469.164 217.227 469.164 216.351C469.164 215.621 470.405 214.745 472.887 213.723C485.735 208.905 498.437 201.167 510.993 190.509C523.549 179.705 534.353 167.806 543.405 154.812C552.457 141.818 558.37 129.846 561.144 118.896C562.166 114.516 562.677 111.158 562.677 108.822C562.677 105.464 561.582 102.763 559.392 100.719C558.516 99.989 557.494 99.259 556.326 98.529C555.304 97.653 554.793 96.996 554.793 96.558C554.793 95.098 556.253 94.368 559.173 94.368C563.407 94.368 567.641 95.317 571.875 97.215C575.525 98.675 579.321 101.595 583.263 105.975C587.351 110.209 589.395 114.078 589.395 117.582C589.395 118.604 589.103 119.553 588.519 120.429C588.081 121.159 587.351 121.962 586.329 122.838C584.723 124.152 583.555 125.393 582.825 126.561C581.511 128.459 579.978 131.087 578.226 134.445C571.218 146.271 563.918 157.002 556.326 166.638C548.88 176.274 538.222 185.983 524.352 195.765C510.628 205.401 494.057 212.482 474.639 217.008C473.617 217.446 472.449 217.665 471.135 217.665ZM488.874 154.812C486.1 154.812 483.837 153.644 482.085 151.308C480.333 148.826 479.165 145.906 478.581 142.548C476.975 131.744 472.595 123.276 465.441 117.144C463.981 115.976 463.251 115.1 463.251 114.516C463.251 113.494 463.908 112.983 465.222 112.983C468.288 112.983 472.668 114.37 478.362 117.144C484.056 119.772 489.093 123.276 493.473 127.656C497.853 132.036 500.043 136.635 500.043 141.453C500.043 144.811 499.094 147.877 497.196 150.651C495.298 153.425 492.524 154.812 488.874 154.812ZM674.544 83.016C694.256 84.6 711.24 88.472 725.496 94.632C739.752 100.616 746.88 109.68 746.88 121.824C746.88 126.224 745.736 129.832 743.448 132.648C741.16 135.464 738.168 136.872 734.472 136.872C728.84 136.872 722.24 132.208 714.672 122.88C707.632 114.256 700.944 107.216 694.608 101.76C688.448 96.304 681.76 92.08 674.544 89.088V91.728C674.544 111.088 674.632 125.432 674.808 134.76L675.072 142.944C675.424 159.312 676.04 171.368 676.92 179.112C678.152 186.68 678.768 193.192 678.768 198.648C678.768 203.224 677.976 207.184 676.392 210.528C674.808 213.872 672.96 216.336 670.848 217.92C668.736 219.504 666.712 220.296 664.776 220.296C661.256 220.296 658 217.92 655.008 213.168C652.016 208.416 649.552 202.96 647.616 196.8C645.856 190.464 644.976 185.536 644.976 182.016C644.976 180.608 645.328 176.56 646.032 169.872C646.912 163.36 647.704 155.44 648.408 146.112C649.464 132.208 650.168 114.344 650.52 92.52V52.392C650.52 40.248 649.992 31.712 648.936 26.784C648.232 23.088 646.912 20.096 644.976 17.808C643.04 15.52 640.4 13.584 637.056 12C636.528 11.824 635.824 11.56 634.944 11.208C634.24 10.856 633.624 10.504 633.096 10.152C632.744 9.79999 632.568 9.44799 632.568 9.09599C632.568 7.15999 636 5.31199 642.864 3.55198C649.728 1.61599 655.184 0.647989 659.232 0.647989C662.576 0.647989 665.656 1.26399 668.472 2.496C671.288 3.72799 674.192 5.75199 677.184 8.568C679.824 11.208 681.144 14.464 681.144 18.336C681.144 20.8 680.528 23.704 679.296 27.048C677.36 32.68 676.04 38.136 675.336 43.416C674.808 48.52 674.544 57.144 674.544 69.288V83.016Z" fill="white"/>
		</svg>
		`;

		const textureJa = new GLP.GLPowerTexture( gl );

		const jaImg = document.createElement( "img" );
		jaImg.src = "data:image/svg+xml," + encodeURIComponent( jaElm );

		jaImg.onload = () => {

			const canvas = document.createElement( "canvas" );
			canvas.width = 1024;
			canvas.height = 512;

			const ctx = canvas.getContext( "2d" )!;

			ctx.fillStyle = "#fff3";
			ctx.fillRect( 0, 0, canvas.width, canvas.height );

			ctx.drawImage( jaImg, 0, 80 );

			ctx.fillStyle = "#FFF";
			ctx.font = `bold ${50}px 'Yu Gothic'`;
			ctx.fillText( "CODE / GRAPHICS / MUSIC: UKONPOWER", 0, 400, 600 );

			textureJa.attach( canvas );

		};

		this.addComponent( "geometry", new GLP.PlaneGeometry( 2.0, 1.0 ) );
		const mat = this.addComponent( "material", new GLP.Material( {
			frag: hotGet( 'mttlFrag', titleFrag ),
			vert: hotGet( 'mttlVert', titleVert ),
			uniforms: GLP.UniformsUtils.merge( {
				uTex: {
					value: textureEn,
					type: "1i"
				},
				uTexJa: {
					value: textureJa,
					type: "1i"
				}
			}, globalUniforms.tex ),
		} ) );

		if ( import.meta.hot ) {

			import.meta.hot.accept( "./shaders/mainTitle.vs", ( module ) => {

				if ( module ) {

					mat.vert = hotUpdate( 'mttlVert', module.default );
					mat.requestUpdate();

				}

			} );

			import.meta.hot.accept( "./shaders/mainTitle.fs", ( module ) => {

				if ( module ) {

					mat.frag = hotUpdate( 'mttlFrag', module.default );
					mat.requestUpdate();

				}

			} );

		}

	}

}
